# 6. Скиды (вклады в подарок)

Сценарии для Playwright: шаги с селекторами и проверки. Локаль — `ru`.

---

## US-6.1 Внести вклад в подарок

### T6.1.1 Успешный вклад

- **Роут:** `/wishlists/s/:slug`
- **Предусловия:** вишлист с товаром, у которого указана цена (создать через API или UI).
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)`
  2. У товара с ценой нажать «Скинуться» → `page.getByRole('button', { name: 'Скинуться' }).first().click()`
  3. Заполнить имя → поле с placeholder «Например: Маша» или лейбл «Ваше имя» → `page.getByPlaceholder(/Маша|Mary/).or(page.getByLabel(/Ваше имя|Your name/)).fill('Маша')`
  4. Заполнить сумму → `page.getByLabel(/Сумма вклада|Contribution amount/).fill('500')`
  5. Подтвердить → `page.getByRole('button', { name: 'Добавить вклад' }).click()`
- **Проверки:**
  - Сообщение об успехе и ссылка на «Мой вклад» (URL с `/contributions/`) → `expect(page.getByText(/Вклад добавлен|Contribution added/i)).toBeVisible()`
  - На странице вишлиста обновилась собранная сумма / прогресс-бар (например «Собрано 500 из 1000») → `expect(page.getByText(/Собрано|Collected/)).toBeVisible()`

---

### T6.1.2 Вклад больше оставшейся суммы

- **Предусловия:** цена товара 5000, уже собрано 3000 (создать вклады через API).
- **Шаги:**
  1. Открыть публичную страницу, нажать «Скинуться» у этого товара.
  2. Ввести сумму больше 2000 (например 3000).
  3. Отправить форму.
- **Проверки:**
  - По ТЗ: либо вклад принят (перебор), либо валидация «не больше X»; проверить фактическое поведение и зафиксировать в тесте.

---

### T6.1.3 Отрицательная или нулевая сумма

- **Роут:** `/wishlists/s/:slug`
- **Шаги:**
  1. Открыть форму «Скинуться», ввести имя, в поле суммы — `0` или `-100`.
  2. Нажать «Добавить вклад».
- **Проверки:**
  - Валидация: сообщение об ошибке или кнопка недоступна; вклад не создаётся.

---

### T6.1.4 Несколько вкладов от разных людей

- **Предусловия:** товар с ценой, один вклад уже есть (создать через API или первый контекст).
- **Шаги:**
  1. В новом контексте (другой «пользователь») открыть `/wishlists/s/{slug}`.
  2. Внести второй вклад по этому товару (другое имя, любая сумма).
  3. Обновить страницу или дождаться обновления (реалтайм).
- **Проверки:**
  - Прогресс/сумма показывают сумму двух вкладов; текст вида «Собрано X из Y», где X = первый вклад + второй вклад.

---

## US-6.2 Владелец не видит, кто скинулся

### T6.2.1 Просмотр списка владельцем

- **Роут:** `/wishlists/manage/:creatorSecret` или публичная страница от владельца.
- **Предусловия:** по товарам есть вклады (имена и суммы от друзей).
- **Шаги:**
  1. Владелец открывает вишлист (manage или public).
- **Проверки:**
  - По каждому товару видна только общая собранная сумма / прогресс; на странице нет списка имён участников и персональных сумм → нет текста с contributor_name и отдельными amount.

---

### T6.2.2 API не возвращает contributor_name/amount владельцу

- **Тип:** API-тест.
- **Шаги:** GET вишлиста (manage или public) от владельца.
- **Проверки:** В ответе у items только `total_contributed` (или аналог); нет массива вкладов с именами и суммами.

---

## US-6.3 Прогресс-бар по сбору

### T6.3.1 Отображение прогресса

- **Роут:** `/wishlists/s/:slug`
- **Предусловия:** у товара цена и вклады (например 3000 из 5000).
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)`
- **Проверки:**
  - Отображается текст «Собрано» и «из» или прогресс-бар (например «3000 из 5000») → `expect(page.getByText(/Собрано|из|Collected|of/)).toBeVisible()`
  - Нет разбивки по участникам (имена/суммы по каждому).

---

### T6.3.2 Товар без цены

- **Предусловия:** товар без поля «цена» или цена пустая.
- **Шаги:**
  1. Открыть публичную страницу вишлиста.
- **Проверки:**
  - У этого товара нет блока «Скинуться» или прогресса (или кнопка «Скинуться» скрыта) → `expect(page.getByRole('button', { name: 'Скинуться' })).toHaveCount(0)` для карточки этого товара или проверка по контексту.

---

## US-6.4 Просмотр и отмена своего вклада

### T6.4.1 Просмотр вклада по contributor_secret

- **Роут:** `/contributions/:contributorSecret`
- **Предусловия:** вклад создан, сохранён `contributor_secret`.
- **Шаги:**
  1. `page.goto('/contributions/' + contributorSecret)`
- **Проверки:**
  - Заголовок «Мой вклад»; отображаются товар, сумма, дата, имя → `expect(page.getByRole('heading', { name: /Мой вклад|My contribution/i })).toBeVisible()` и текст с суммой/именем.

---

### T6.4.2 Отмена вклада

- **Роут:** `/contributions/:contributorSecret`
- **Шаги:**
  1. `page.goto('/contributions/' + contributorSecret)`
  2. `page.getByRole('button', { name: 'Отменить вклад' }).click()`
  3. Подтвердить диалог.
- **Проверки:**
  - Сообщение об отмене или редирект; на публичной странице вишлиста сумма/прогресс уменьшились (при необходимости открыть страницу и проверить).

---

### T6.4.3 Невалидный contributor_secret

- **Шаги:**
  1. `page.goto('/contributions/invalid-secret-xyz')`
- **Проверки:**
  - «Вклад не найден» или 404 → `expect(page.getByText(/не найден|not found/i)).toBeVisible()`.
