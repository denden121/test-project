# 4. Шаринг и просмотр вишлиста

Формат для Playwright: шаги с селекторами и проверки. Локаль — `ru`.

---

## US-4.1 Делиться списком по ссылке

### T4.1.1 Копирование ссылки

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Предусловия:** вишлист создан.
- **Шаги:**
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. Нажать «Копировать ссылку» → `page.getByRole('button', { name: 'Копировать ссылку' }).click()` (или клик по полю с URL и копирование через clipboard).
- **Проверки:**
  - В буфере обмена содержится строка вида `.../wishlists/s/{slug}`. В Playwright: `const handle = await page.evaluateHandle(() => navigator.clipboard.readText());` после клика или проверка, что в read-only поле отображается URL с `/wishlists/s/` → `expect(page.locator('input[readonly]')).toHaveValue(new RegExp('/wishlists/s/'))`

---

### T4.1.2 Открытие ссылки без авторизации

- **Предусловия:** есть ссылка на вишлист (получить slug после создания).
- **Шаги:**
  1. Использовать контекст без сохранённого storage (гость) или инкогнито.
  2. `page.goto(baseURL + '/wishlists/s/' + slug)`
- **Проверки:**
  - Открылась публичная страница вишлиста (заголовок списка, товары если есть); нет кнопок управления списком → `expect(page).toHaveURL(/\/wishlists\/s\//)` и при необходимости отсутствие кнопки «Удалить список».

---

## US-4.2 Просмотр вишлиста по ссылке (друг)

### T4.2.1 Просмотр по валидному slug

- **Роут:** `/wishlists/s/:slug`
- **Предусловия:** вишлист существует, в нём есть товары (создать через API или сценарий).
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)`
- **Проверки:**
  - Отображается название списка → `expect(page.getByRole('heading', { name: wishlistTitle })).toBeVisible()` (или по тексту из данных).
  - Отображаются товары: название, ссылка, цена, картинка (если заданы) — проверить наличие карточек товаров и текста названия первого товара.

---

### T4.2.2 Просмотр по несуществующему slug

- **Шаги:**
  1. `page.goto('/wishlists/s/nonexistent-slug-12345')`
- **Проверки:**
  - Сообщение «Список не найден» или 404 → `expect(page.getByText(/не найден|not found|404/i)).toBeVisible()` или `expect(page).toHaveURL(/404/)` по реализации.

---

### T4.2.3 Вид для гостя: зарезервировано / не зарезервировано

- **Роут:** `/wishlists/s/:slug`
- **Предусловия:** в вишлисте есть несколько товаров; часть зарезервирована (создать резервации через API).
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)`
- **Проверки:**
  - У незарезервированного товара видна кнопка «Зарезервировать подарок» → `expect(page.getByRole('button', { name: 'Зарезервировать подарок' })).toBeVisible()`
  - У зарезервированного товара отображается «Зарезервировано» и нет имён резервировавших → `expect(page.getByText('Зарезервировано')).toBeVisible()` и отсутствие текста с reserver_name.

---

### T4.2.4 Вид для гостя: прогресс сбора по товару

- **Роут:** `/wishlists/s/:slug`
- **Предусловия:** у товара указана цена и есть вклады (создать через API).
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)`
- **Проверки:**
  - Отображается прогресс: текст вида «Собрано X из Y» или прогресс-бар → `expect(page.getByText(/Собрано|Collected|из/)).toBeVisible()`
  - Нет отображения имён участников или персональных сумм вкладов.
