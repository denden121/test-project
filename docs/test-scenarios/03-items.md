# 3. Товары в вишлисте

Шаги и проверки для Playwright. Локаль — `ru`. Селекторы полей — по лейблам или по месту в форме (Название, Ссылка на товар, Цена, URL картинки).

---

## US-3.1 Добавление товара

### T3.1.1 Добавление с полными данными

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Предусловия:** вишлист создан, открыта страница управления.
- **Шаги:**
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. Заполнить поля товара: название → `page.getByLabel('Название').fill('Книга')`; ссылка → по лейблу «Ссылка на товар»; цена → по лейблу «Цена» (например `1000`); URL картинки → по лейблу «URL картинки» (например `https://example.com/img.jpg`).
  3. Нажать кнопку добавления товара → `page.getByRole('button', { name: 'Добавить товар' }).click()` (или по тексту кнопки сохранения формы товара).
- **Проверки:**
  - В списке на странице появилась карточка/строка с «Книга» → `expect(page.getByText('Книга')).toBeVisible()`
  - Открыть публичную страницу `/wishlists/s/{slug}` и проверить: отображаются название, ссылка, цена, картинка для этого товара.

---

### T3.1.2 Добавление только с названием

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Шаги:**
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. Заполнить только название товара, остальные поля пустые.
  3. Отправить форму добавления товара.
- **Проверки:**
  - Товар создан и виден в списке → `expect(page.getByText('Только название')).toBeVisible()` (подставить введённое название).

---

### T3.1.3 Валидация цены

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Шаги:**
  1. Открыть форму добавления товара.
  2. Название заполнить, в поле «Цена» ввести `-100` или нечисловое значение (например `abc`).
  3. Отправить форму.
- **Проверки:**
  - Ошибка валидации или значение не принято; товар с отрицательной ценой не появляется в списке.

---

### T3.1.4 Валидация URL (ссылка/картинка)

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Шаги:**
  1. В форме товара в поле ссылки или URL картинки ввести `not-a-url`.
  2. Отправить форму.
- **Проверки:**
  - По реализации: сообщение об ошибке или сохранение как текст; проверить видимость ошибки или отсутствие некорректного перехода по ссылке на публичной странице.

---

## US-3.2 Редактирование товара

### T3.2.1 Успешное редактирование

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Предусловия:** в списке есть хотя бы один товар.
- **Шаги:**
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. Нажать «Изменить» у нужного товара → `page.getByRole('button', { name: 'Изменить' }).first().click()` (или по контексту карточки товара).
  3. Изменить название/цену/ссылку в форме.
  4. Сохранить → `page.getByRole('button', { name: 'Сохранить' }).click()`
- **Проверки:**
  - В списке отображаются новые данные; на публичной странице по slug — те же изменения.

---

### T3.2.2 Редактирование зарезервированного товара

- **Предусловия:** товар зарезервирован (создать резервацию через API или второй контекст).
- **Шаги:**
  1. На странице управления изменить название/цену/ссылку зарезервированного товара и сохранить.
- **Проверки:**
  - Данные товара обновились; резервация остаётся (на публичной странице товар по-прежнему «Зарезервировано»).

---

## US-3.3 Удаление товара

### T3.3.1 Удаление незарезервированного товара

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Предусловия:** есть товар без резервации и без вкладов.
- **Шаги:**
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. У нужного товара нажать «Удалить» → `page.getByRole('button', { name: 'Удалить' }).first().click()` (или «Удалить» в контексте карточки).
  3. Подтвердить диалог при наличии → `page.on('dialog', d => d.accept())`
- **Проверки:**
  - Товар исчез из списка на странице управления.

---

### T3.3.2 Удаление зарезервированного товара

- **Предусловия:** товар зарезервирован (есть `reserver_secret`).
- **Шаги:**
  1. На странице управления удалить зарезервированный товар (с подтверждением).
  2. Открыть страницу «Моя резервация» → `page.goto('/reservations/' + reserverSecret)`
- **Проверки:**
  - На странице резервации отображается «Резервация не найдена» или 404/пустой контент.

---

### T3.3.3 Удаление товара с вкладами

- **Предусловия:** по товару есть вклады (создать через API или второй контекст).
- **Шаги:**
  1. На странице управления удалить этот товар (с подтверждением).
- **Проверки:**
  - Товар исчез из списка; при открытии ссылки вклада (`/contributions/:contributorSecret`) — «Вклад не найден» или аналог.
