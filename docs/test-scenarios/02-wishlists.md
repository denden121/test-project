# 2. Создание и управление вишлистами

Формат: шаги с селекторами и проверки для Playwright. Локаль — `ru`.

---

## US-2.1 Создание списка желаний

### T2.1.1 Успешное создание списка

- **Роут:** `/wishlists/new` (требуется авторизация).
- **Предусловия:** пользователь залогинен (storage state или логин в `beforeEach`).
- **Шаги:**
  1. `page.goto('/wishlists/new')`
  2. Заполнить название → `page.getByLabel('Название списка').or(page.locator('#title')).fill('День рождения')`
  3. `page.getByRole('button', { name: 'Создать' }).click()`
- **Проверки:**
  - Редирект на страницу управления → `expect(page).toHaveURL(/\/wishlists\/manage\//)`
  - На странице есть блок «Ссылка для друзей» или поле с путём `/wishlists/s/` → `expect(page.getByText(/\/wishlists\/s\//)).toBeVisible()`
  - Заголовок страницы или текст содержит «День рождения» (название списка) → по контексту страницы.

---

### T2.1.2 Создание без названия

- **Роут:** `/wishlists/new`
- **Предусловия:** пользователь залогинен.
- **Шаги:**
  1. `page.goto('/wishlists/new')`
  2. Не заполнять название (оставить пустым).
  3. `page.getByRole('button', { name: 'Создать' }).click()`
- **Проверки:**
  - Сообщение валидации «Обязательное поле» → `expect(page.getByText(/Обязательное поле|Required field/i)).toBeVisible()`
  - URL остаётся `/wishlists/new` → `expect(page).toHaveURL(/\/wishlists\/new/)`

---

### T2.1.3 Уникальность slug и открытие по ссылке

- **Роут:** создать список, затем открыть публичную ссылку.
- **Предусловия:** пользователь залогинен; после создания списка взять `slug` из URL или со страницы управления.
- **Шаги:**
  1. Создать вишлист (T2.1.1) или через API получить `slug`.
  2. Открыть в новой навигации `page.goto('/wishlists/s/' + slug)` (или в том же контексте).
- **Проверки:**
  - Страница публичного вишлиста открылась → `expect(page).toHaveURL(new RegExp('/wishlists/s/' + slug))`
  - Виден заголовок списка (например «День рождения») → `expect(page.getByRole('heading', { name: /День рождения/ })).toBeVisible()` (или по тексту из данных).

---

## US-2.2 Редактирование списка (название)

### T2.2.1 Успешное изменение названия

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Предусловия:** вишлист создан, есть `creator_secret`; на странице управления есть редактирование названия (если реализовано в UI). *В текущем UI может не быть отдельного поля «название» на manage — тогда сценарий проверяет только доступ к manage и отображение данных; при появлении поля — заполнить и сохранить.*
- **Шаги:** (если есть форма названия)
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. Изменить значение поля названия и сохранить (селекторы по реальной разметке).
- **Проверки:**
  - На публичной странице по `slug` отображается новое название → открыть `/wishlists/s/{slug}` и `expect(page.getByText('Новое название')).toBeVisible()`.

*Если в приложении нет редактирования названия на manage-странице, сценарий можно пометить как «когда будет UI» или проверять только PATCH через API.*

---

### T2.2.2 Редактирование без creator_secret недоступно

- **Роут:** `/wishlists/s/:slug` (только публичная ссылка).
- **Предусловия:** вишлист создан.
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)` (без перехода на manage).
- **Проверки:**
  - На странице нет кнопок «Удалить список», «Добавить товар» (только просмотр) → `expect(page.getByRole('button', { name: 'Удалить список' })).not.toBeVisible()` и при необходимости `expect(page.getByRole('button', { name: 'Добавить товар' })).not.toBeVisible()` (если такие кнопки есть только на manage).

---

## US-2.3 Удаление списка

### T2.3.1 Успешное удаление

- **Роут:** `/wishlists/manage/:creatorSecret`
- **Предусловия:** вишлист создан, есть `creator_secret`; на странице есть кнопка «Удалить список».
- **Шаги:**
  1. `page.goto('/wishlists/manage/' + creatorSecret)`
  2. `page.getByRole('button', { name: 'Удалить список' }).click()`
  3. Подтвердить в `dialog` → `page.on('dialog', d => d.accept())` (в тесте настроить до клика).
- **Проверки:**
  - Редирект на главную → `expect(page).toHaveURL(/\/$/)`
  - По старой ссылке публичной страницы — 404 или «Список не найден» → `page.goto('/wishlists/s/' + slug)`, затем `expect(page.getByText(/не найден|not found|404/i)).toBeVisible()` (или проверка статуса/контента).

---

### T2.3.2 Удаление по slug без secret недоступно

- **Роут:** `/wishlists/s/:slug`
- **Шаги:**
  1. `page.goto('/wishlists/s/' + slug)` (без авторизации или с авторизацией, но без перехода на manage).
- **Проверки:**
  - Кнопки «Удалить список» нет → `expect(page.getByRole('button', { name: 'Удалить список' })).not.toBeVisible()`.
